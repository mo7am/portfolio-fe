import{_ as pe}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-01c6a1ae.js";import{_ as fe}from"./AppTextField.vue_vue_type_style_index_0_lang-ff2427f7.js";import{d as he,J as _e,r as v,bm as W,c_ as ve,H as ge,I as ye,m as G,p as be,cS as H,o as n,c as m,b as d,f as h,h as x,Q as A,R as V,k as s,V as S,W as we,e as a,Z as J,ci as j,a0 as xe,F as M,z as D,y as I,cR as Q}from"./index-ab2bc521.js";import{_ as Z}from"./Lucide.vue_vue_type_script_setup_true_lang-5dcb49e0.js";import{_ as X}from"./LoadingIcon.vue_vue_type_script_setup_true_lang-2352b216.js";import{_ as ke}from"./Pagination.vue_vue_type_script_setup_true_lang-6d9bdbde.js";import{a as Y,b as Ce,V as F}from"./VCard-c9d7cfad.js";import{V as Re}from"./VCardText-6d82c75f.js";import{V as Ve}from"./VForm-bdbb87d6.js";import{V as Se}from"./VDialog-4ab52581.js";const Me=a("p",{class:"text-base mb-0"},"Set Role Permissions",-1),Ee={id:"name"},Ie={class:"flex justify-between flex-wrap gap-1 md:gap-4"},Ne=a("h6",{class:"text-h4 mt-8 mb-3"},[A(" Role Permissions "),a("span",{class:"required-icon"},"*")],-1),Te=a("span",null,"Clone Role",-1),Le={key:0,class:"p-4"},Pe=a("div",{id:"permissions"},null,-1),$e={class:"grid md:grid-cols-2 lg:grid-cols-2 gap-4"},je={class:"flex justify-between flex-wrap gap-1 md:gap-4"},De={class:"font-medium"},Fe=["onClick"],Ae=a("span",null,"Select All",-1),Be={class:"flex flex-col gap-1 mt-2"},Oe=["onClick"],Ue={class:"mt-4 flex justify-center"},ze={key:1},Ke={class:"p-4 mt-4"},qe={class:"flex gap-2"},We={class:"mt-4"},Ge={key:0,class:"flex p-4"},He=["onClick"],Je={class:"font-medium"},Qe={class:"capitalize"},Ze={key:2,class:"py-2 text-slate-400"},Xe={key:3,class:"mt-4 flex m-auto"},Ye={class:"w-full flex"},ds=he({__name:"Form",props:{isMerchant:{type:Boolean,default:!0}},setup(ee){var z,K;const p=_e("api"),k=v([]),w=v([]),c=ee,f=W({initial:!1,submitting:!1,roleList:!1}),C=ve(),se=ge(),u=v({}),_=v(""),B=v(),te=ye(),y=v(!1),N=v({}),b=v(null),R=W({search:"",page:1,limit:6});let T=0,r=0,g=0;c.isMerchant?(r=C.getIDToEdit,T=C.getIDToEdit):(r=(z=G().params)==null?void 0:z.id,T=(K=G().params)==null?void 0:K.id),c.isMerchant?g=C.getIDToClone:g=se.getIDToClone,g!=0&&(r=g);const L=v(!1),ae=async()=>{var t;f.initial=!0;try{let e=null;c.isMerchant?e=await p.roles.getCreateRole():e=await p.admin.roles.getCreateRole(),k.value=await((t=e==null?void 0:e.data)==null?void 0:t.data)}catch(e){console.log(e)}f.initial=!1},O=async()=>{var t,e,l,E,o;f.initial=!0;try{let i=null;c.isMerchant?i=await p.roles.getEditRole(r):i=await p.admin.roles.getEditRole(r),k.value=await((t=i==null?void 0:i.data)==null?void 0:t.allPermissions),_.value=await((l=(e=i==null?void 0:i.data)==null?void 0:e.role)==null?void 0:l.name),(o=await((E=i==null?void 0:i.data)==null?void 0:E.preSelectedPermissions))==null||o.forEach(q=>{u.value[q]=!0})}catch(i){console.log(i)}f.initial=!1},le=t=>{u.value[t]?delete u.value[t]:u.value[t]=!0},P=be(()=>k.value.reduce((t,e)=>(oe(e)&&e.id&&t.push(e.id),t),[])),oe=t=>{let e=0;return t.permissions.forEach(l=>{u.value[l.id]&&e++}),e===t.permissions.length},ie=t=>{const e=!P.value.includes(t.id);t.permissions.forEach(l=>{e?u.value[l.id]=!0:delete u.value[l.id]})},U=async()=>{var t,e;if(!(!((e=await((t=B.value)==null?void 0:t.validate()))!=null&&e.valid)||L.value)){f.submitting=!0;try{r!=0&&r!=null&&g==0?c.isMerchant?await p.roles.editRole(r,{name:_.value,permissions:Object.keys(u.value)}):await p.admin.roles.editRole(r,{name:_.value,permissions:Object.keys(u.value)}):c.isMerchant?await p.roles.createRole({name:_.value,permissions:Object.keys(u.value)}):await p.admin.roles.createRole({name:_.value,permissions:Object.keys(u.value)}),Q.fire({icon:"success",padding:"10px",background:"#fff",html:`<span style="font-size:14px">Role ${r!=0&&r!=null&&g==0?"Updated":"Added"} Successfully!</span>`}),c.isMerchant?(C.setIsPopupVisible(!1),C.setIsGetData()):te.push({name:"admin-roles"})}catch(l){console.log(l)}f.submitting=!1}},ne=async()=>{try{c.isMerchant?await p.roles.checkIsNameValid({name:_.value},r):await p.admin.roles.checkIsNameValid({name:_.value},r),L.value=!1}catch(t){L.value=!0,console.log(t)}},re=async t=>{y.value=!0,b.value=t},ce=async()=>{b.value?(k.value=[],_.value="",u.value={},r=b.value.id,O(),y.value=!1,b.value=null,g==0&&(r=T)):Q.fire({icon:"success",padding:"10px",background:"#fff",html:'<span style="font-size:14px">Select role first!</span>'})},de=async()=>{y.value=!0,$()},$=async()=>{var t,e;f.roleList=!0;try{let l=null;c.isMerchant?l=await p.roles.getRolesList(R):l=await p.admin.roles.getRolesList(R),w.value=await((t=l==null?void 0:l.data)==null?void 0:t.data),N.value=await((e=l==null?void 0:l.data)==null?void 0:e.meta)}catch(l){console.log(l)}f.roleList=!1},ue=H(ne,800);r?O():ae();const me=H($,600);return(t,e)=>{const l=fe,E=pe;return n(),m(M,null,[d(F,{class:"md:py-8 md:px-5"},{default:h(()=>[d(Y,{class:"text-center"},{default:h(()=>[c.isMerchant?S("",!0):(n(),x(Ce,{key:0,class:"text-h3 mb-3"},{default:h(()=>[A(V(s(r)!=0&&s(r)!=null&&s(g)==0?"Edit":"Add New")+" Role ",1)]),_:1})),Me]),_:1}),d(Re,{class:"mt-6"},{default:h(()=>[d(Ve,{ref_key:"refForm",ref:B,onSubmit:we(U,["prevent"])},{default:h(()=>[a("div",Ee,[d(l,{type:"text",modelValue:s(_),"onUpdate:modelValue":e[0]||(e[0]=o=>J(_)?_.value=o:null),name:"name",label:"Role Name",placeholder:"Enter Role Name",onKeyup:s(ue),isRequired:!0},null,8,["modelValue","onKeyup"])]),a("div",Ie,[Ne,a("span",{onClick:de,class:"text-h5 cursor-pointer mt-8 mb-3"},[d(j,{class:"text-white",color:c.isMerchant?"primary":"black"},{default:h(()=>[d(xe,{icon:"tabler-copy"}),Te]),_:1},8,["color"])])]),s(f).initial?(n(),m("div",Le,"Loading...")):(n(),m(M,{key:1},[Pe,a("div",$e,[(n(!0),m(M,null,D(s(k),o=>(n(),x(F,{class:"!p-4 shadow-lg",key:o.id},{default:h(()=>[a("div",je,[a("h3",De,V(o.name),1),a("button",{class:"flex items-center",type:"button",onClick:i=>ie(o)},[a("span",{class:I(["flex w-4 h-4 rounded-sm mr-2 border shadow-sm",P.value.includes(o.id)?c.isMerchant?"bg-primary":"bg-black":"bg-white"])},[P.value.includes(o.id)?(n(),x(s(Z),{key:0,icon:"Check",class:"w-4 h-4 m-auto text-white"})):S("",!0)],2),Ae],8,Fe)]),a("div",Be,[(n(!0),m(M,null,D(o.permissions,i=>(n(),m("button",{key:i,class:"flex items-center",type:"button",onClick:q=>le(i.id)},[a("span",{class:I(["flex w-4 h-4 rounded-sm mr-2 border shadow-sm",s(u)[i.id]?c.isMerchant?"bg-primary":"bg-black":"bg-white"])},[s(u)[i.id]?(n(),x(s(Z),{key:0,icon:"Check",class:"w-4 h-4 m-auto text-white"})):S("",!0)],2),a("span",null,V(i.display_name),1)],8,Oe))),128))])]),_:2},1024))),128))])],64))]),_:1},512)]),_:1}),d(Y,{class:"py-2 mt-auto"},{append:h(()=>[a("div",Ue,[d(j,{color:c.isMerchant?"primary":"black",class:"text-white flex min-w-[92px]",onClick:U},{default:h(()=>[s(f).submitting?(n(),x(s(X),{key:0,icon:"tail-spin",color:"white",class:"block m-auto w-4 h-4"})):(n(),m("span",ze,"Submit"))]),_:1},8,["color"])])]),_:1})]),_:1}),d(Se,{modelValue:s(y),"onUpdate:modelValue":e[4]||(e[4]=o=>J(y)?y.value=o:null),width:"500"},{default:h(()=>[d(E,{onClick:e[1]||(e[1]=o=>{y.value=!1,b.value=null})}),d(F,null,{default:h(()=>[a("div",Ke,[a("div",qe,[d(l,{type:"text",modelValue:s(R).search,"onUpdate:modelValue":e[2]||(e[2]=o=>s(R).search=o),placeholder:"Search Roles",onKeyup:s(me)},null,8,["modelValue","onKeyup"])]),a("div",We,[s(f).roleList&&!s(w).length?(n(),m("div",Ge,[d(s(X),{icon:"tail-spin",class:"w-6 h-6 m-auto",color:"orange"})])):s(w).length?(n(),m("div",{key:1,class:I(["flex flex-col gap-1 max-h-[400px] overflow-auto",{"opacity-70 pointer-events-none":s(f).roleList&&s(w).length}])},[(n(!0),m(M,null,D(s(w),o=>(n(),m("div",{style:{"padding-top":"5px","padding-bottom":"10px"},class:I([s(b)&&s(b).id==o.id?"border-b-2":"border-b-1","relative flex justify-between items-center cursor-pointer"]),onClick:i=>re(o)},[a("p",Je,V(o.name),1),a("p",Qe,"Users: "+V(o.users.length),1)],10,He))),256))],2)):(n(),m("div",Ze,"No roles found")),s(N)?(n(),m("div",Xe,[d(ke,{onPageChanged:e[3]||(e[3]=o=>{s(R).page=o,$()}),meta:s(N),class:"w-full sm:w-auto sm:mr-auto"},null,8,["meta"])])):S("",!0),a("div",Ye,[s(w).length?(n(),x(j,{key:0,color:c.isMerchant?"primary":"black",type:"button",class:"text-white mt-3 w-[60%] mx-auto",onClick:ce},{default:h(()=>[A("Save")]),_:1},8,["color"])):S("",!0)])])])]),_:1})]),_:1},8,["modelValue"])],64)}}});export{ds as _};
