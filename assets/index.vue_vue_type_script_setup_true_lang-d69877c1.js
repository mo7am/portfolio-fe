import{d as ne,J as re,bm as H,r,H as de,c_ as ue,w as M,cS as j,o as c,c as x,k as s,b as i,V as me,M as ce,U as pe,f as p,e as o,cQ as y,b6 as fe,R,h as z,Q as S,ci as U,W as ve,Z as he,F as _e,a as ye,cR as ge}from"./index-ab2bc521.js";import{_ as we}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-01c6a1ae.js";import{_ as xe}from"./AppSelect.vue_vue_type_script_setup_true_lang-3371fd7f.js";import{_ as Ve}from"./AppTextField.vue_vue_type_style_index_0_lang-ff2427f7.js";import{_ as be}from"./LoadingIcon.vue_vue_type_script_setup_true_lang-2352b216.js";import{_ as ke}from"./Lucide.vue_vue_type_script_setup_true_lang-5dcb49e0.js";import{V as Ce}from"./VSwitch-75acd94a.js";import{b as Ee}from"./VTextField-bc742ce7.js";import{V as Se}from"./VForm-bdbb87d6.js";import{V as Ue}from"./VCard-c9d7cfad.js";import{V as Oe}from"./VDialog-4ab52581.js";const Te={key:0,class:"flex"},De={class:"flex justify-between"},Ie=o("div",{class:"flex flex-col"},[o("label",{class:"text-base",for:"status"},"Active"),o("span",{class:"text-slate-300 text-xs"}," Active: Control whether the operator active to make functionality. ")],-1),Pe={class:"grid md:grid-cols-2 gap-4"},$e={id:"name"},Le={class:"relative",id:"role_id"},Ne={class:"grid md:grid-cols-2 gap-4"},Re={id:"email"},Ae={id:"username"},Be={class:"grid md:grid-cols-2 gap-4"},qe={id:"pin_code"},Fe={id:"phone"},Ke={class:"text-sm text-danger mt-1"},He={class:"grid md:grid-cols-2 gap-4"},Me={id:"password"},je={class:"flex justify-end mt-4"},ze={class:"py-8 px-4"},Qe={class:"mb-2 flex"},Ge={key:0,class:"text-center text-xl text-danger"},Je={key:1,class:"text-center text-xl text-danger"},We={key:2,class:"mt-4 flex justify-center"},Ye=o("span",null,"Yes?",-1),Ze={key:3,class:"mt-4 flex justify-center"},mt=ne({__name:"index",props:{merchant_id:{type:Number,default:null}},emits:["closePopup"],setup(Q,{emit:G}){var K;const f=re("api"),g=Q,J=G,a=H({id:null,name:"",status:!1,email:null,username:null,role_id:"",password:"",pin_code:"",phone:"",isOldUser:!1}),A=r(""),B=r(""),V=r(!1),w=r(!1),u=r(!1),P=r(""),$=r(""),O=r(!1),T=r(!1),b=r(!1),k=r(!1),v=r(""),q=r(!1),L=r(!1),d=H({initial:!1,submitting:!1,check:!1}),D=(K=de().getTenant)==null?void 0:K.id,C=r({}),E=ue(),W=async()=>{d.initial=!0;try{let l={};if(g.merchant_id>0){let e={params:{merchant_id:g.merchant_id}};const n=await f.admin.operator.createOperator(e);C.value=await(n==null?void 0:n.data),a.username="",a.password=""}else{const e=await f.operator.createOperator();C.value=await(e==null?void 0:e.data)}}catch(l){console.log(l)}d.initial=!1},F=l=>{A.value="+"+l.countryCallingCode,B.value=l.formatted,k.value=!(!l.valid||l.valid==null)},Y=l=>{y("phone"),k.value||l.length==0?(v.value="",k.value&&a.phone.toLowerCase().indexOf(A.value)===-1&&(a.phone=B.value)):k.value||(v.value="The phone field format is invalid.")};M(k,l=>{l?v.value="":v.value="The phone field format is invalid."});const Z=async l=>{var e,n,m,I;d.initial=!0;try{const h=await f.operator.editOperator(l);C.value=await(h==null?void 0:h.data);const t=(e=C.value)==null?void 0:e.operator;let _=null;t.merchants.length>0&&(_=t.merchants.find(ie=>ie.id===D)),t&&(a.id=t==null?void 0:t.id,a.name=t==null?void 0:t.name,a.email=t==null?void 0:t.email,a.username=(n=_==null?void 0:_.merchant_user)==null?void 0:n.username,a.role_id=(m=t==null?void 0:t.role)==null?void 0:m.id,a.pin_code=(I=_==null?void 0:_.merchant_user)==null?void 0:I.pin_code,a.phone=t==null?void 0:t.phone,a.password="",a.status=(t==null?void 0:t.status)==="active",T.value=t==null?void 0:t.is_invited,b.value=!!(!a.id&&!(t!=null&&t.is_invited)&&(a.email||a.username)||a.id&&!(t!=null&&t.is_invited)&&a.email))}catch(h){console.log(h)}d.initial=!1},X=async()=>{d.submitting=!0;try{let l={...a,status:a.status?"active":"inactive",merchant_id:D},e;if(E.getIDToEdit)e=await f.operator.updateOperator(E.getIDToEdit,l),P.value="Updated";else{if(g.merchant_id>0){let n={...l,merchant_id:g.merchant_id};e=await f.admin.operator.storeOperator(n),q.value=!0}else e=await f.operator.storeOperator(l);P.value="Created"}e!==void 0&&(q.value?J("closePopup"):(E.setIsPopupVisible(!1),E.setIsGetData()),ge.fire({icon:"success",padding:"10px",background:"#fff",html:`<span style="font-size:14px">${"Operator "+P.value+" successfully"}</span>`}))}catch(l){console.log(l)}d.submitting=!1};M(()=>E.getIDToEdit,l=>{l?Z(l):W()},{immediate:!0});const ee=async()=>{if(y("password"),a.password==""){const l=document.getElementById("passwordId");l&&(l.style.marginTop="-10px")}else{const l=document.getElementById("passwordId");l&&(l.style.marginTop="0px")}},te=()=>{a.status=!a.status},ae=async l=>{L&&(L.value=l==null?void 0:l.getModifierState("CapsLock"))},se=async()=>{d.check=!0;try{const l=await f.admin.merchants.checkUserExistance({email:a.email});a.isOldUser=!1;let e=l.data.user;if(e!=null&&e.id)if(e.type=="admin")V.value=!0,u.value=!0,$.value="Email is already exists for pps admin, you are not be able to use it !";else{let n=e.merchants.find(m=>m.id===D);e.merchants.some(function(m){return m.id===D})?n.merchant_user.user_id==e.id&&n.merchant_user.is_admin==1&&(u.value=!0,V.value=!0,$.value="Email is already exists for this merchant admin, you are not be able to use it !"):(a.isOldUser=!0,V.value=!1,a.name=e.name,a.phone=e.phone,a.status=e==null?void 0:e.is_active,w.value=!0)}else u.value=!1,w.value=!1;b.value=!!(!a.id&&!T.value&&(a.email||a.username)||a.id&&!T.value&&a.email),d.check=!1}catch{}},le=j(()=>{y("email"),se()},800),oe=j(()=>{y("username"),a.username||a.email&&!T.value?b.value=!0:b.value=!1},200),N=()=>{u.value=!1,a.isOldUser=!1,w.value=!1};return(l,e)=>{const n=Ve,m=xe,I=ye("vue-tel-input"),h=we;return c(),x(_e,null,[s(d).initial?(c(),x("div",Te,[i(s(be),{icon:"tail-spin",color:"orange",class:"w-6 h-6 mx-auto"})])):me("",!0),ce(i(Se,{onSubmit:ve(X,["prevent"]),class:"flex flex-col gap-4 mt-4"},{default:p(()=>[o("div",De,[Ie,o("div",null,[i(Ce,{modelValue:s(a).status,"onUpdate:modelValue":e[0]||(e[0]=t=>s(a).status=t),id:"status",color:"success",onClick:te,class:"cursor-pointer"},null,8,["modelValue"])])]),o("div",Pe,[o("div",$e,[i(n,{onKeyup:e[1]||(e[1]=t=>("removeError"in l?l.removeError:s(y))("name")),readOnly:s(w),modelValue:s(a).name,"onUpdate:modelValue":e[2]||(e[2]=t=>s(a).name=t),label:"Name",placeholder:"Type Here...",isRequired:!0},null,8,["readOnly","modelValue"])]),o("div",Le,[i(m,{"onUpdate:modelValue":[e[3]||(e[3]=t=>("removeError"in l?l.removeError:s(y))("role_id")),e[4]||(e[4]=t=>s(a).role_id=t)],readOnly:s(w),modelValue:s(a).role_id,items:s(C).roles,label:"Role","item-title":"name","item-value":"id","form-id":"role_id",placeholder:"Select Role",isRequired:!0},null,8,["readOnly","modelValue","items"])])]),o("div",Ne,[o("div",Re,[i(n,{onKeyup:e[5]||(e[5]=t=>s(le)()),modelValue:s(a).email,"onUpdate:modelValue":e[6]||(e[6]=t=>s(a).email=t),label:"Email",placeholder:"Type Here..."},null,8,["modelValue"])]),o("div",Ae,[i(n,{onKeyup:e[7]||(e[7]=t=>s(oe)()),modelValue:s(a).username,"onUpdate:modelValue":e[8]||(e[8]=t=>s(a).username=t),label:"Username",placeholder:"Type Here..."},null,8,["modelValue"])])]),o("div",Be,[o("div",qe,[i(n,{onKeyup:e[9]||(e[9]=t=>("removeError"in l?l.removeError:s(y))("pin_code")),modelValue:s(a).pin_code,"onUpdate:modelValue":e[10]||(e[10]=t=>s(a).pin_code=t),label:"Pin Code",placeholder:"Type Here...",isRequired:!0},null,8,["modelValue"])]),o("div",Fe,[i(Ee,{for:"phone",class:"mb-2",text:"Phone"}),i(I,{readOnly:s(w),onValidate:e[11]||(e[11]=t=>F(t)),onCountryChanged:e[12]||(e[12]=t=>F(t)),onKeyup:e[13]||(e[13]=t=>Y(s(a).phone)),modelValue:s(a).phone,"onUpdate:modelValue":e[14]||(e[14]=t=>s(a).phone=t),defaultCountry:"US",mode:"international",autoDefaultCountry:!0,invalidMsg:"dasdsadsa",validCharactersOnly:!0,autoFormat:!0,inputOptions:{maxlength:25,required:!0,autocomplete:"on",placeholder:"Enter Phone Number"},dropdownOptions:{showSearchBox:!0,searchBoxPlaceholder:"Search Country",showFlags:!0,showDialCodeInList:!0,showDialCodeInSelection:!1}},null,8,["readOnly","modelValue"]),o("div",{class:"v-input__details",style:fe(s(v)!=""?"display:block":"display:none")},[o("div",Ke,R(s(v)),1)],4)])]),o("div",He,[o("div",Me,[i(n,{onKeydown:ae,onKeyup:ee,modelValue:s(a).password,"onUpdate:modelValue":e[15]||(e[15]=t=>s(a).password=t),label:"Password",placeholder:"············",type:s(O)?"text":"password","append-inner-icon":s(O)?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[16]||(e[16]=t=>O.value=!s(O)),hasCapsLock:s(L),currentId:"passwordId",isRequired:s(b)},null,8,["modelValue","type","append-inner-icon","hasCapsLock","isRequired"])])]),o("div",je,[s(v)!=""?(c(),z(U,{key:0,class:"w-fit px-10 text-white",color:g.merchant_id>0?"black":"primary"},{default:p(()=>[S("Save")]),_:1},8,["color"])):(c(),z(U,{key:1,type:"submit",class:"w-fit px-10 text-white",color:g.merchant_id>0?"black":"primary"},{default:p(()=>[S(R(s(d).submitting?"Loading...":"Save"),1)]),_:1},8,["color"]))])]),_:1},512),[[pe,!s(d).initial]]),i(Oe,{modelValue:s(u),"onUpdate:modelValue":e[18]||(e[18]=t=>he(u)?u.value=t:null),width:"500"},{default:p(()=>[i(h,{onClick:N}),i(Ue,null,{default:p(()=>[o("div",ze,[o("div",Qe,[i(ke,{icon:"AlertTriangle",class:"m-auto w-16 h-16 text-danger"})]),s(V)?(c(),x("div",Je,R(s($)),1)):(c(),x("div",Ge," Email is already exists, are you sure you want to add this user to this merchant ? ")),s(V)?(c(),x("div",Ze,[i(U,{color:"warning",onClick:N},{default:p(()=>[S("CLose!")]),_:1})])):(c(),x("div",We,[i(U,{color:"warning",onClick:N},{default:p(()=>[S("No!")]),_:1}),S("     "),i(U,{class:"flex text-white",color:"primary",onClick:e[17]||(e[17]=t=>{u.value=!1,s(a).isOldUser=!0})},{default:p(()=>[Ye]),_:1})]))])]),_:1})]),_:1},8,["modelValue"])],64)}}});export{mt as _};
