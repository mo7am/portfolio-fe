import{_ as ee}from"./Discount.vue_vue_type_style_index_0_lang-6aecf1aa.js";import{_ as H}from"./AppTextField.vue_vue_type_style_index_0_lang-ff2427f7.js";import{_ as te}from"./DialogCloseBtn.vue_vue_type_script_setup_true_lang-01c6a1ae.js";import{d as M,o as a,c as D,e as n,y as j,h as S,k as e,V as T,R as $,cU as se,a4 as oe,J as X,r as x,bm as U,cS as ie,w as ne,bd as le,b as u,f as h,F as J,z as Q,Q as z,ci as R,bq as ae,M as ce,W as ue,Z as de,cR as O,db as re}from"./index-ab2bc521.js";import{_ as L}from"./Lucide.vue_vue_type_script_setup_true_lang-5dcb49e0.js";import{_ as G}from"./LoadingIcon.vue_vue_type_script_setup_true_lang-2352b216.js";import{_ as pe}from"./Pagination.vue_vue_type_script_setup_true_lang-6d9bdbde.js";import{P as Y}from"./vue3-perfect-scrollbar.esm-8af4f7c1.js";import{V as W}from"./VCard-c9d7cfad.js";import{V as Z}from"./VDialog-4ab52581.js";import{V as me}from"./VSwitch-75acd94a.js";import{V as fe}from"./VForm-bdbb87d6.js";import"./validators-6509741b.js";import"./DatePicker.vue_vue_type_style_index_0_lang-9c1149fd.js";import"./VTextField-bc742ce7.js";import"./transition-99e7ac04.js";import"./forwardRefs-6ea3df5c.js";import"./VImg-7ee89f5e.js";import"./VMenu-6ec9b18a.js";import"./VOverlay-39b4b039.js";import"./dialog-transition-6ea18c7a.js";import"./VCardText-6d82c75f.js";import"./createSimpleFunctional-c52b7322.js";import"./VTabs-036eabe8.js";import"./VRadioGroup-a2bdd812.js";import"./VSelectionControl-e6ec7db0.js";import"./VAvatar-b89a8ade.js";const _e={class:"flex items-start gap-2 relative"},ve={class:"font-medium"},ge={class:"capitalize"},ye={class:"font-medium"},De=M({__name:"DiscountSetting",props:{discount:{},isInPopup:{type:Boolean},isSelected:{type:Boolean}},emits:["click","deselectDiscount","editDiscountClick"],setup(A,{emit:P}){const d=A,b=P,_=()=>{b("click",d.discount)},m=()=>{b("deselectDiscount",{...d.discount,pre_selected:d.discount.status==="active"},d.isInPopup)},w=()=>{b("editDiscountClick",d.discount.id)};return(t,y)=>(a(),D("div",null,[n("div",{class:j(["relative flex justify-between items-center border-b",t.isInPopup?"cursor-pointer":"not-in-popup"]),onClick:y[2]||(y[2]=l=>_())},[n("div",_e,[t.isInPopup?(a(),D("div",{key:0,class:j(["w-4 h-4 mt-[3px] flex rounded-sm border bg-white shadow-sm cursor-pointer",{"check-box transition":!t.isInPopup,"bg-primary":t.isSelected}]),onClick:y[0]||(y[0]=l=>m())},[t.isSelected?(a(),S(e(L),{key:0,icon:"Check",class:"w-4 h-4 m-auto text-white"})):T("",!0)],2)):T("",!0),n("div",{class:j({"box transition":!t.isInPopup})},[n("p",ve,$(t.discount.type==="amount"?"$":"")+" "+$(("makeFLoat"in t?t.makeFLoat:e(se))(t.discount.amount,""))+" "+$(t.discount.type!=="amount"?"%":""),1),n("p",ge,$(t.discount.type),1)],2)]),n("div",{class:"flex items-center gap-1 cursor-pointer",onClick:y[1]||(y[1]=l=>w())},[n("p",ye,$(t.discount.name),1),t.isInPopup?T("",!0):(a(),S(e(L),{key:0,icon:"ChevronRight",class:"w-4 h-4 text-gray-500"}))])],2)]))}});const he=oe(De,[["__scopeId","data-v-84843e75"]]),be={class:"flex flex-col"},we=n("div",{class:"bg-[#fafafa] px-4 py-1"},[n("h3",{class:"font-medium text-lg text-center"},"Apply Card Discounts")],-1),xe={key:0,class:"flex flex-col gap-1 py-2 max-h-[250px]",style:{"padding-right":"0.8rem !important"}},ke={key:1,class:"py-2 text-slate-400"},Se={class:"p-4 mt-4"},Ce={class:"flex gap-2"},$e={class:"mt-4"},Pe={key:0,class:"flex p-4"},Ve={key:2,class:"py-2 text-slate-400"},Ie={key:3,class:"mt-4 flex m-auto"},Ee={class:"w-full flex"},je={class:"py-8 px-4"},Te={class:"font-medium text-lg"},Re=M({__name:"GeneralDiscountsSettings",props:{preSelectedDiscounts:{}},emits:["setDiscounts"],setup(A,{emit:P}){const d=A,b=P,_=X("api"),m=x(!1),w=x([]),t=x({}),y=U({search:"",page:1,limit:5,sorting:"asc"}),l=U({selectPreview:!1,discountPreview:!1,discountIdToEdit:0}),k=x({}),V=x({}),I=x({}),E=async()=>{var s,o;m.value=!0;try{const i=await _.inventory.settings.getAllCartDiscounts(y);w.value=await((s=i==null?void 0:i.data)==null?void 0:s.data),t.value=await((o=i==null?void 0:i.data)==null?void 0:o.meta)}catch(i){console.error(i)}m.value=!1},N=()=>{d.preSelectedDiscounts.forEach(s=>{k.value[s.id]={...s,pre_selected:!0}}),I.value={}},q=s=>{k.value[s.id]?(delete k.value[s.id],V.value[s.id]=!0,s!=null&&s.pre_selected&&(I.value[s.id]=!0)):(k.value[s.id]=s,delete V.value[s.id],delete I.value[s.id])},B=s=>{const o=Object.keys(k.value).map(Number),i=Object.keys(V.value).map(Number),v=Object.keys(I.value).map(Number);console.log(v),i.forEach(g=>{const C=d.preSelectedDiscounts.findIndex(c=>c.id===g);C>-1&&d.preSelectedDiscounts.splice(C,1)}),o.forEach(g=>{const C=k.value[g],c=d.preSelectedDiscounts.findIndex(K=>K.id===g);c>-1?d.preSelectedDiscounts[c]=C:d.preSelectedDiscounts.push(C)}),b("setDiscounts",o,"discounts"),b("setDiscounts",v,"unselected_discounts"),V.value={},s||(l.selectPreview=!1)},F=(s,o)=>{q(s),B(o)},p=ie(E,600),f=s=>{if(!l.discountIdToEdit)E();else{const o=d.preSelectedDiscounts.findIndex(i=>i.id===s.id);o>-1&&(d.preSelectedDiscounts[o]=s)}l.discountIdToEdit=0,l.discountPreview=!1},r=s=>{l.discountIdToEdit=s,l.discountPreview=!0};return ne(()=>d.preSelectedDiscounts,N),le(()=>{N()}),(s,o)=>{const i=he,v=te,g=H,C=ee;return a(),D("div",be,[we,u(e(Y),{options:{wheelPropagation:!1}},{default:h(()=>[s.preSelectedDiscounts.length?(a(),D("div",xe,[(a(!0),D(J,null,Q(s.preSelectedDiscounts,c=>(a(),S(i,{discount:c,isSelected:!0,onDeselectDiscount:F,onEditDiscountClick:r,key:c.id},null,8,["discount"]))),128))])):(a(),D("div",ke,"No Discounts Selected"))]),_:1}),u(R,{type:"button",variant:"text",class:"flex justify-start items-center px-0 py-2",onClick:o[0]||(o[0]=c=>(e(l).selectPreview=!0,E()))},{default:h(()=>[u(e(L),{icon:"Plus",class:"w-6 h-6 mr-1"}),z(" Edit Selected Discounts ")]),_:1}),u(Z,{modelValue:e(l).selectPreview,"onUpdate:modelValue":o[6]||(o[6]=c=>e(l).selectPreview=c),width:"500"},{default:h(()=>[u(v,{onClick:o[1]||(o[1]=c=>e(l).selectPreview=!1)}),u(W,null,{default:h(()=>[n("div",Se,[n("div",Ce,[u(g,{type:"text",modelValue:e(y).search,"onUpdate:modelValue":o[2]||(o[2]=c=>e(y).search=c),placeholder:"Search Discounts",onKeyup:e(p)},null,8,["modelValue","onKeyup"]),u(R,{onClick:o[3]||(o[3]=c=>e(l).discountPreview=!0)},{default:h(()=>[u(e(L),{icon:"Plus",class:"w-6 h-6 text-white"})]),_:1})]),n("div",$e,[e(m)&&!e(w).length?(a(),D("div",Pe,[u(e(G),{icon:"tail-spin",class:"w-6 h-6 m-auto",color:"orange"})])):e(w).length?(a(),D("div",{key:1,class:j(["flex flex-col gap-1 max-h-[400px] overflow-auto",{"opacity-70 pointer-events-none":e(m)&&e(w).length}])},[(a(!0),D(J,null,Q(e(w),c=>(a(),S(i,{discount:c,isInPopup:!0,isSelected:!!e(k)[c.id],onDeselectDiscount:F,onEditDiscountClick:r,key:c.id},null,8,["discount","isSelected"]))),128))],2)):(a(),D("div",Ve,"No Discounts found")),e(t)?(a(),D("div",Ie,[u(pe,{onPageChanged:o[4]||(o[4]=c=>{e(y).page=c,E()}),meta:e(t),class:"w-full sm:w-auto sm:mr-auto"},null,8,["meta"])])):T("",!0),n("div",Ee,[e(w).length?(a(),S(R,{key:0,type:"button",class:"mt-3 w-[60%] mx-auto",onClick:o[5]||(o[5]=c=>B(!1))},{default:h(()=>[z("Save")]),_:1})):T("",!0)])])])]),_:1})]),_:1},8,["modelValue"]),u(Z,{modelValue:e(l).discountPreview,"onUpdate:modelValue":o[8]||(o[8]=c=>e(l).discountPreview=c),width:"500"},{default:h(()=>[u(v,{onClick:o[7]||(o[7]=c=>e(l).discountPreview=!1)}),u(W,null,{default:h(()=>[n("div",je,[n("h3",Te,$(e(l).discountIdToEdit?"Edit":"Create")+" Discount ",1),u(C,{idToEdit:e(l).discountIdToEdit,isInSettings:!0,onSubmitted:f},null,8,["idToEdit"])])]),_:1})]),_:1},8,["modelValue"])])}}}),Ae={class:"p-4 bg-white max-h-[530px] pr-1",style:{"padding-right":"0.8rem !important"}},Ne={key:0,class:"flex p-4"},Be={class:"flex flex-col"},Fe=n("div",{class:"bg-[#fafafa] px-4 py-1"},[n("h3",{class:"font-medium text-lg text-center"},"General")],-1),Ge={class:"flex flex-col gap-4 py-2"},Ue={id:"name"},ze={id:"business_type",class:"flex flex-col gap-2"},Le=n("label",{for:"business_type"},"Business Type",-1),Me={class:"grid grid-cols-3 p-1 bg-[#fafafa]",id:"business_type"},qe=["onClick"],Oe={class:"flex justify-between"},Je=n("label",{class:"text-base",for:"allow_double_discount"},"Allow Double Discount",-1),Qe={id:"adjust_prices_percentage"},We={key:1},Ze={key:0,class:"gap-4",style:{float:"left",padding:"4px 10px 7px 15px"}},He={key:1},Xe=M({__name:"GeneralSettings",setup(A){const P=[{key:"retail",title:"Retail"},{key:"restaurant",title:"Restaurant"},{key:"schedule",title:"Schedule"}],d=x(),b=X("api"),_=U({initialData:!1,submitting:!1,reset:!1,adjust:!1}),m=x({}),w=x([]),t=U({name:"",business_type:"retail",allow_double_discount:!1,discounts:[],unselected_discounts:[]}),y=x([]),l=x([]),k=async()=>{_.adjust=!0;try{const p=await b.inventory.settings.adjustAllPrices(Number(d.value));d.value="",O.fire({icon:"success",padding:"10px",background:"#fff",html:'<span style="font-size:14px">Prices Adjusted Successfully!</span>'})}catch(p){console.log(p)}_.adjust=!1},V=async()=>{var p,f,r,s,o;_.initialData=!0;try{const i=await b.inventory.settings.getGeneralSettings();m.value=await(i==null?void 0:i.data);const v=await((p=m.value)==null?void 0:p.setting);v&&(t.name=v==null?void 0:v.name,t.allow_double_discount=!!(v!=null&&v.allow_double_discount),t.business_type=v.business_type,t.discounts=[],t.unselected_discounts=[],y.value=[]),(r=(f=m.value)==null?void 0:f.activeCartDiscounts)!=null&&r.length&&(w.value=(s=m.value)==null?void 0:s.activeCartDiscounts,(o=m.value)==null||o.activeCartDiscounts.forEach(g=>{y.value.push(g.id)}))}catch(i){console.log(i)}_.initialData=!1},I=async()=>{var p,f,r,s;console.log(t),_.submitting=!0;try{const o=await b.inventory.settings.updateSettings(t);t.discounts=[],t.unselected_discounts=[],m.value=await(o==null?void 0:o.data);const i=await((p=m.value)==null?void 0:p.setting);i&&(t.name=i==null?void 0:i.name,t.allow_double_discount=!!(i!=null&&i.allow_double_discount),t.business_type=i.business_type,t.discounts=[],t.unselected_discounts=[],y.value=[]),(r=(f=m.value)==null?void 0:f.activeCartDiscounts)!=null&&r.length&&((s=m.value)==null||s.activeCartDiscounts.forEach(v=>{y.value.push(v.id)})),O.fire({icon:"success",padding:"10px",background:"#fff",html:'<span style="font-size:14px">Settings Updated Successfully!</span>'})}catch(o){console.log(o)}_.submitting=!1},E=()=>{t.allow_double_discount=!t.allow_double_discount},N=(p,f)=>{f==="discounts"&&(l.value.length>0&&(l.value=l.value.filter(r=>!p.includes(r))),p=p.filter(r=>!y.value.includes(r))),f==="unselected_discounts"&&l.value.length>0&&(l.value=l.value.filter(r=>y.value.includes(r)),p=q(l.value,p)),t[f]=[],p.forEach((r,s)=>{t[f][s]=r})};function q(p,f){const r=new Map;return p.forEach(s=>r.set(s,!0)),f.forEach(s=>r.set(s,!0)),Array.from(r.keys())}const B=()=>{_.initialData=!1,O.fire({icon:"success",padding:"10px",background:"#fff",html:'<span style="font-size:14px">Settings Reset Successfully!</span>'})},F=()=>{l.value=w.value.map(p=>p.id),_.initialData=!0,m.value={},m.value.activeCartDiscounts=[],t.name="",t.business_type="retail",t.allow_double_discount=!1,t.discounts=[],d.value="",setTimeout(B,900)};return V(),(p,f)=>{const r=H,s=Re,o=ae("can");return a(),D("div",null,[u(e(Y),{options:{wheelPropagation:!1}},{default:h(()=>{var i,v;return[n("section",Ae,[e(_).initialData&&!((i=e(m))!=null&&i.setting)?(a(),D("div",Ne,[u(e(G),{icon:"tail-spin",class:"w-6 h-6 m-auto",color:"orange"})])):(a(),D("div",{key:1,class:j({"opacity-70":e(_).initialData&&e(m)})},[n("div",Be,[Fe,n("div",Ge,[n("div",Ue,[u(r,{type:"text",modelValue:e(t).name,"onUpdate:modelValue":f[0]||(f[0]=g=>e(t).name=g),label:"Name",placeholder:"Name",isRequired:!0},null,8,["modelValue"])]),n("div",ze,[Le,n("div",Me,[(a(),D(J,null,Q(P,g=>n("button",{class:j(["p-2 rounded text-black",e(t).business_type===g.key?"bg-primary text-white":"bg-secondary text-primary"]),key:g.key,onClick:C=>e(t).business_type=g.key},$(g.title),11,qe)),64))])]),n("div",null,[n("div",Oe,[Je,n("div",null,[u(me,{modelValue:e(t).allow_double_discount,"onUpdate:modelValue":f[1]||(f[1]=g=>e(t).allow_double_discount=g),id:"allow_double_discount",color:"success",onClick:E,class:"cursor-pointer"},null,8,["modelValue"])])])]),ce((a(),S(fe,{onSubmit:ue(k,["prevent"]),ref:"formRef",class:"grid sm:grid-cols-2 gap-4"},{default:h(()=>[n("div",Qe,[u(r,{type:"number",min:-10,max:10,modelValue:e(d),"onUpdate:modelValue":f[2]||(f[2]=g=>de(d)?d.value=g:null),label:"Percent",placeholder:"0.00"},null,8,["modelValue"])]),u(R,{type:"button",class:"sm:mt-[30px] sm:!h-[40px]",onClick:k},{default:h(()=>[e(_).adjust?(a(),S(e(G),{key:0,icon:"tail-spin",class:"w-4 h-4",color:"white"})):(a(),D("span",We,"Adjust All Prices"))]),_:1})]),_:1})),[[o,"adjust-all-prices-setting"]])])]),u(s,{preSelectedDiscounts:((v=e(m))==null?void 0:v.activeCartDiscounts)||{},onSetDiscounts:N},null,8,["preSelectedDiscounts"])],2))])]}),_:1}),e(_).initialData?T("",!0):(a(),D("div",Ze,[u(R,{class:"w-[50%] mx-auto mt-4",onClick:I,disabled:e(_).initialData||e(_).submitting},{default:h(()=>[e(_).submitting?(a(),S(e(G),{key:0,icon:"tail-spin",class:"w-4 h-4",color:"white"})):(a(),D("span",He,"Save"))]),_:1},8,["disabled"]),z("    "),u(R,{style:{"margin-top":"15px"},class:"w-[25%] mx-auto bg-gray",onClick:F},{default:h(()=>[z(" Reset ")]),_:1})]))])}}});const St=M({__name:"index",setup(A){return re("Inventory Settings"),(P,d)=>{const b=Xe;return a(),S(b)}}});export{St as default};
