import{r as F,m as j,d as ee}from"./validators-6509741b.js";import{d as te,r as T,bm as R,J as ae,cP as ie,w as A,k as i,o as m,c as _,h as $,f as v,e as o,b as r,F as D,z as x,Q as B,R as w,b6 as L,V as le,y as M,M as se,bQ as oe,ci as ne,W as de,cR as re,cQ as N}from"./index-ab2bc521.js";import{_ as ue}from"./AppTextField.vue_vue_type_style_index_0_lang-ff2427f7.js";import{_ as C}from"./DatePicker.vue_vue_type_style_index_0_lang-9c1149fd.js";import{V as me}from"./VCardText-6d82c75f.js";import{V as ce,a as pe}from"./VTabs-036eabe8.js";import{V as z,a as H}from"./VRadioGroup-a2bdd812.js";import{V as fe}from"./VForm-bdbb87d6.js";const _e={key:0,class:"mt-4"},ve={class:"grid md:grid-cols-1 gap-4"},ye={class:"grid md:grid-cols-2 gap-4"},Ve={id:"name"},ge={id:"amount"},be=o("label",{class:"form-label"},"Use Mode",-1),he={key:0},ke=o("label",{class:"form-label"},"Discount Type",-1),Te={class:"grid md:grid-cols-2 gap-4"},De={id:"start_date"},xe={id:"end_date"},Ce={id:"start_time"},Se={id:"end_time"},Ue=o("br",null,null,-1),$e={id:"days"},we={class:"grid md:grid-cols-4 gap-4"},Ee={class:"d-flex gap-4"},Ie={class:"input-group",style:{display:"flex","margin-left":"-7px"}},qe=["id","onClick"],Fe=["for"],Re={class:"custom-option-body"},Ae={class:"custom-option-title"},Be=["onUpdate:modelValue","id"],Le={class:"flex justify-end mt-4"},Me={class:"flex justify-end mt-4"},Ke=te({__name:"Discount",props:{idToEdit:{},isInSettings:{type:Boolean}},emits:["submitted"],setup(Q,{emit:G}){const h=Q,O=G,P=[{key:!0,title:"Card"},{key:!1,title:"Item"}],E=T(),a=R({id:"",name:"",amount:0,use_mode:"manual",type:"amount",start_date:"",end_date:"",start_time:"00:00",end_time:"23:59",days:[],is_cart_discount:!1}),S=T([]),y=T({}),p=R({initial:!1,submitting:!1}),k=ae("api"),V=ie(),U=T(""),J=async()=>{var l;p.initial=!0;try{const t=await k.inventory.discount.createDiscount();y.value=await(t==null?void 0:t.data),a.is_cart_discount=V.getDiscountType=="cart";let d=(l=t==null?void 0:t.data)==null?void 0:l.weekDays.map(function(e){return{checked:!1,value:e.value,name:e.name}});S.value=d}catch(t){console.log(t)}p.initial=!1},I=async l=>{var t,d,e,n,f;p.initial=!0;try{const u=await k.inventory.discount.editDiscount(l);y.value=await(u==null?void 0:u.data);const s=(t=y.value)==null?void 0:t.discount;if(s){Object.keys(a).forEach(c=>{a[c]=s[c]}),a.start_time=s.start_time?((d=s==null?void 0:s.start_time)==null?void 0:d.substring(0,(s==null?void 0:s.start_time.length)-3))+"":"",a.end_time=s.end_time?((e=s==null?void 0:s.end_time)==null?void 0:e.substring(0,(s==null?void 0:s.end_time.length)-3))+"":"";let q=(n=u==null?void 0:u.data)==null?void 0:n.weekDays.map(function(c){return{checked:!1,value:c.value,name:c.name}});if(s!=null&&s.days&&(s==null?void 0:s.days.length)>0){let c=[];(f=u==null?void 0:u.data)==null||f.weekDays.map(function(b){s!=null&&s.days.includes(b.value)?c.push({checked:!0,value:b.value,name:b.name}):c.push({checked:!1,value:b.value,name:b.name})}),q=c}else a.days=[];S.value=q}}catch(u){console.log(u)}p.initial=!1},K=async()=>{var l,t,d;if((t=await((l=E.value)==null?void 0:l.validate()))!=null&&t.valid){p.submitting=!0;try{let e={...a,is_cart_discount:a.is_cart_discount?1:0},n;const f=h.idToEdit?h.idToEdit:V.getIDToEdit;f?(n=await k.inventory.discount.updateDiscount(f,e),U.value="Updated"):(n=await k.inventory.discount.storeDiscount(e),U.value="Created"),n!==void 0&&(h.isInSettings?O("submitted",(d=n==null?void 0:n.data)==null?void 0:d.data):(V.setIsPopupVisible(!1),V.setIsGetData()),re.fire({icon:"success",padding:"10px",background:"#fff",html:`<span style="font-size:14px">${"Discount "+U.value+" successfully"}</span>`}))}catch(e){console.log(e)}p.submitting=!1}},W=l=>{a.type=l},X=l=>{a.use_mode=l},g=l=>{N(l)},Y=(l,t)=>{var d=document.getElementById("1"+l);if(N("days"),t.target.checked!=null)if(t.target.checked)d==null||d.classList.add("checked"),a.days.push(l);else{d==null||d.classList.remove("checked");const e=a.days.indexOf(l);a.days.splice(e,1)}};A(()=>V.getIDToEdit,l=>{l?I(l):J()},{immediate:!0});const Z=l=>{a.is_cart_discount=l};return A(()=>h.idToEdit,l=>{l&&I(l)},{immediate:!0}),(l,t)=>{const d=ue;return i(p).initial?(m(),_("div",_e,"Loading...")):(m(),$(fe,{key:1,ref_key:"refForm",ref:E,onSubmit:de(K,["prevent"]),class:"flex flex-col gap-4 mt-4"},{default:v(()=>[o("div",ve,[r(me,{class:"d-flex flex-column gap-2"},{default:v(()=>[o("div",null,[r(ce,{class:"v-tabs-pill",modelValue:i(a).type,"onUpdate:modelValue":t[0]||(t[0]=e=>i(a).type=e),"fixed-tabs":""},{default:v(()=>[(m(!0),_(D,null,x(i(y).DiscountTypes,e=>(m(),$(pe,{key:e.value,value:e.value,onClick:n=>W(e.value)},{default:v(()=>[B(w(e.name),1)]),_:2},1032,["value","onClick"]))),128))]),_:1},8,["modelValue"])])]),_:1}),o("div",ye,[o("div",Ve,[r(d,{modelValue:i(a).name,"onUpdate:modelValue":t[1]||(t[1]=e=>i(a).name=e),label:"Name","form-id":"name",placeholder:"Type Here...",rules:["requiredValidator"in l?l.requiredValidator:i(F),("maxAlphaValidator"in l?l.maxAlphaValidator:i(j))(i(a).name,255)],isRequired:!0},null,8,["modelValue","rules"])]),o("div",ge,[r(d,{onKeyup:t[2]||(t[2]=e=>g("amount")),modelValue:i(a).amount,"onUpdate:modelValue":t[3]||(t[3]=e=>i(a).amount=e),label:`Amount ${i(a).type=="amount"?"$":"%"}`,"form-id":"amount",placeholder:"Type Here...",isRequired:!0,rules:["requiredValidator"in l?l.requiredValidator:i(F),("decimalValidator"in l?l.decimalValidator:i(ee))(i(a).percentage,2)]},null,8,["modelValue","label","rules"])]),o("div",null,[be,r(z,{inline:"",modelValue:i(a).use_mode,"onUpdate:modelValue":t[4]||(t[4]=e=>i(a).use_mode=e),style:{"margin-top":"10px"}},{default:v(()=>[(m(!0),_(D,null,x(i(y).DiscountUseModes,(e,n)=>(m(),$(H,{label:e.name,value:e.value,style:L(n==1?"margin-left: 80px;":""),onClick:f=>X(e.value),density:"compact"},null,8,["label","value","style","onClick"]))),256))]),_:1},8,["modelValue"])]),i(a).id?le("",!0):(m(),_("div",he,[ke,r(z,{inline:"",modelValue:i(a).is_cart_discount,"onUpdate:modelValue":t[5]||(t[5]=e=>i(a).is_cart_discount=e),style:{"margin-top":"10px"}},{default:v(()=>[(m(),_(D,null,x(P,(e,n)=>r(H,{label:e.title,value:e.key,style:L(n==1?"margin-left: 80px;":""),onClick:f=>Z(e.key),density:"compact"},null,8,["label","value","style","onClick"])),64))]),_:1},8,["modelValue"])]))]),o("div",{class:M(i(a).use_mode=="auto"?"":"d-none")},[o("div",Te,[o("div",De,[r(i(C),{"onUpdate:modelValue":[t[6]||(t[6]=e=>g("start_date")),t[7]||(t[7]=e=>i(a).start_date=e)],modelValue:i(a).start_date,label:"Start Date",placeholder:"Select Date",config:{inline:!0}},null,8,["modelValue"])]),o("div",xe,[r(i(C),{"onUpdate:modelValue":[t[8]||(t[8]=e=>g("end_date")),t[9]||(t[9]=e=>i(a).end_date=e)],modelValue:i(a).end_date,label:"End Date",placeholder:"Select Date",config:{inline:!0}},null,8,["modelValue"])]),o("div",Ce,[r(i(C),{"onUpdate:modelValue":[t[10]||(t[10]=e=>g("start_time")),t[11]||(t[11]=e=>i(a).start_time=e)],modelValue:i(a).start_time,label:"Start Time",placeholder:"Select Time",isTime:!0,isRequired:!0,config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue"])]),o("div",Se,[r(i(C),{"onUpdate:modelValue":[t[12]||(t[12]=e=>g("end_time")),t[13]||(t[13]=e=>i(a).end_time=e)],modelValue:i(a).end_time,label:"End Time",placeholder:"Select Time",isRequired:!0,isTime:!0,config:{enableTime:!0,noCalendar:!0,dateFormat:"H:i"}},null,8,["modelValue"])])]),Ue,o("div",$e,[o("div",we,[o("div",Ee,[o("div",Ie,[(m(!0),_(D,null,x(i(S),e=>(m(),_("div",{id:"1"+e.value,class:M([e.checked?"checked":"","form-check custom-option custom-option-icon"]),onClick:n=>Y(e.value,n)},[o("label",{class:"form-check-label custom-option-content",for:e.value},[o("span",Re,[o("span",Ae,w(e.name),1)]),se(o("input",{"onUpdate:modelValue":n=>e.checked=n,class:"form-check-input",type:"checkbox",id:e.value},null,8,Be),[[oe,e.checked]])],8,Fe)],10,qe))),256))])])])])],2)]),o("div",Le,[o("div",Me,[r(ne,{type:"submit",class:"btn btn-primary w-fit px-8"},{default:v(()=>[B(w(i(p).submitting?"Loading...":"Save"),1)]),_:1})])])]),_:1},512))}}});export{Ke as _};
