import{d as Z,H as O,J as X,I as ee,r as u,bm as se,db as ae,a as te,o as c,c as R,e as i,b as o,k as s,G as j,y as f,f as r,$ as K,Q as _,R as v,h as x,W as oe,cQ as k,V as S,Z as ne,ci as ie}from"./index-ab2bc521.js";import{r as T}from"./validators-6509741b.js";import{_ as re}from"./AppTextField.vue_vue_type_style_index_0_lang-ff2427f7.js";import{a as le,b as de}from"./auth-v1-top-shape-c5f58476.js";import{V as I}from"./VNodeRenderer-ca9ffdcc.js";import{_ as me}from"./LoadingIcon.vue_vue_type_script_setup_true_lang-2352b216.js";import{a as ue,V as pe}from"./VCard-c9d7cfad.js";import{V as H}from"./VCardText-6d82c75f.js";import{V as ce}from"./VForm-bdbb87d6.js";import{V as fe,a as B}from"./VRow-ba1da485.js";import{V as he}from"./VCheckbox-70ac096e.js";const ge={class:"auth-wrapper d-flex align-center justify-center pa-4"},ve={class:"position-relative my-sm-16"},ye={class:"flex w-[170px] h-[45px]"},be={class:"text-h4 mb-1"},Ve={class:"text-capitalize"},_e=i("p",{class:"mb-0"}," Please sign-in to your account and start the adventure ",-1),ke={key:0},we=i("h4",{class:"font-medium text-lg text-center"}," Sorry, Your Account is temporarily locked ",-1),Ae={class:"text-base text-center mt-2"},Ce={key:0,id:"business_id"},Le={id:"username"},Re={class:"v-messages",role:"alert","aria-live":"polite"},xe={class:"v-messages__message text-danger"},Se={class:"d-flex align-center justify-space-between flex-wrap mt-2 mb-4"},je=Z({__name:"LoginForm",props:{isAdmin:{type:Boolean}},setup(Y){const w=Y,l=O(),z=X("api"),A=ee(),y=u(!1),C=u(!1),h=u(""),b=u(!1),D=u(!1),V=u(!1),Q=w.isAdmin?{username:"admin@pps.com",password:"admin123"}:{business_id:"merch1business",username:"merch1user@mailinator.com",password:"Password_!3"},d=se(Q),E=u(),L=u(l.getRemaining);ae("Sign In");const F=()=>{const e=setInterval(()=>{let a=l.getRemaining;a>0&&(a--,l.setRemaining(a),L.value=l.getRemaining)},1e3);return k("username"),k("business_id"),()=>{clearInterval(e)}};l.getRemaining>0&&F();const W=async()=>{var e,a,p,g,n,P,q,M,U,N,$;if(!((a=await((e=E.value)==null?void 0:e.validate()))!=null&&a.valid)){h.value="";return}V.value=!0;try{const t=w.isAdmin?"admin":"merchant",m=await z.auth.login(t,d);l.setUser(m.data.user),l.setToken(m.data.token,b.value),l.setPermissions(m.data.permissions),t=="merchant"&&(l.setTenant(m.data.tenant),l.setPosSettings(m.data.tenant.posSetting)),(g=(p=m==null?void 0:m.data)==null?void 0:p.user)!=null&&g.is_change_password?w.isAdmin?A.push("/admin/dashboard"):A.push("/dashboard"):A.push("/change-password")}catch(t){console.log(t),h.value="",((n=t==null?void 0:t.response)==null?void 0:n.status)===429&&((q=(P=t==null?void 0:t.response)==null?void 0:P.data)!=null&&q.retry_after)?(l.setRemaining(((U=(M=t==null?void 0:t.response)==null?void 0:M.data)==null?void 0:U.retry_after)||0),F()):(((N=t==null?void 0:t.response)==null?void 0:N.status)==401||(($=t==null?void 0:t.response)==null?void 0:$.status)==400)&&(h.value=t.response.data.message)}V.value=!1},G=async e=>{C&&(C.value=e==null?void 0:e.getModifierState("CapsLock"))},J=async()=>{if(d.password==""){const e=document.getElementById("passwordId");e&&(e.style.marginTop="-10px")}else{const e=document.getElementById("passwordId");e&&(e.style.marginTop="0px")}};return(e,a)=>{const p=re,g=te("RouterLink");return c(),R("div",ge,[i("div",ve,[o(s(I),{nodes:("h"in e?e.h:s(j))("div",{innerHTML:s(le)}),class:f(["auth-v1-top-shape d-none d-sm-block",e.isAdmin?"text-black":"text-primary"])},null,8,["nodes","class"]),o(s(I),{nodes:("h"in e?e.h:s(j))("div",{innerHTML:s(de)}),class:f(["auth-v1-bottom-shape d-none d-sm-block",e.isAdmin?"text-black":"text-primary"])},null,8,["nodes","class"]),o(pe,{class:"auth-card pa-4","max-width":"448"},{default:r(()=>[o(ue,{class:"justify-center"},{prepend:r(()=>[i("div",ye,[o(s(I),{nodes:s(K).app.logo},null,8,["nodes"])])]),_:1}),o(H,{class:"pt-1"},{default:r(()=>[i("h4",be,[_(" Welcome to "),i("span",Ve,v(s(K).app.title),1),_("! 👋🏻 ")]),_e]),_:1}),o(H,null,{default:r(()=>[s(L)>0?(c(),R("div",ke,[we,i("p",Ae," You have entered your password wrong more than 3 times. You will have to wait for "+v(s(L))+" seconds to continue. ",1)])):(c(),x(ce,{key:1,ref_key:"refForm",ref:E,onSubmit:oe(W,["prevent"])},{default:r(()=>[o(fe,{class:"gap-2"},{default:r(()=>[o(B,{class:"py-0",cols:"12"},{default:r(()=>[e.isAdmin?S("",!0):(c(),R("div",Ce,[o(p,{onKeyup:a[0]||(a[0]=n=>("removeError"in e?e.removeError:s(k))("business_id")),modelValue:s(d).business_id,"onUpdate:modelValue":a[1]||(a[1]=n=>s(d).business_id=n),label:"Business ID",type:"text",placeholder:"e.g. 123456",rules:["requiredValidator"in e?e.requiredValidator:s(T)]},null,8,["modelValue","rules"])]))]),_:1}),o(B,{class:"py-0",cols:"12"},{default:r(()=>[i("div",Le,[o(p,{onKeyup:a[2]||(a[2]=n=>("removeError"in e?e.removeError:s(k))("username")),modelValue:s(d).username,"onUpdate:modelValue":a[3]||(a[3]=n=>s(d).username=n),label:"Email/UserName",type:"email",placeholder:"e.g. example@email.com",rules:["requiredValidator"in e?e.requiredValidator:s(T)]},null,8,["modelValue","rules"])]),i("div",{class:f(["v-input__details",s(h)?"!block":"!hidden"])},[i("div",Re,[i("div",xe,v(s(h)),1)])],2)]),_:1}),o(B,{class:"py-0",cols:"12"},{default:r(()=>[o(p,{onKeydown:G,onKeyup:J,modelValue:s(d).password,"onUpdate:modelValue":a[4]||(a[4]=n=>s(d).password=n),label:"Password",placeholder:"············",type:s(y)?"text":"password","append-inner-icon":s(y)?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[5]||(a[5]=n=>y.value=!s(y)),rules:["requiredValidator"in e?e.requiredValidator:s(T)],hasCapsLock:s(C),currentId:"passwordId"},null,8,["modelValue","type","append-inner-icon","rules","hasCapsLock"]),i("div",Se,[o(he,{modelValue:s(b),"onUpdate:modelValue":a[6]||(a[6]=n=>ne(b)?b.value=n:null),label:"Remember me"},null,8,["modelValue"]),o(g,{class:f(["text-base",e.isAdmin?"text-black":"text-primary"]),to:e.isAdmin?{name:"admin-forget-password"}:{name:"forget-password"}},{default:r(()=>[_(" Forgot Password? ")]),_:1},8,["class","to"])]),o(ie,{block:"",color:e.isAdmin?"black":"primary",class:f({"text-white":e.isAdmin}),type:"submit"},{default:r(()=>[_(v(s(V)?"":"Login")+" ",1),s(V)?(c(),x(s(me),{key:0,icon:"tail-spin",color:"white",class:"block w-4 h-4"})):S("",!0)]),_:1},8,["color","class"])]),_:1}),s(D)?(c(),x(g,{key:0,class:f(["text-base text-center",e.isAdmin?"text-black":"text-primary"]),to:e.isAdmin?{name:"login"}:{name:"admin-login"}},{default:r(()=>[i("span",null,v(e.isAdmin?"Login To Merchant":"Login To Admin"),1)]),_:1},8,["class","to"])):S("",!0)]),_:1})]),_:1},512))]),_:1})]),_:1})])])}}});export{je as _};
